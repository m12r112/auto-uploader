name: โป๏ธ Refresh Instagram Token

on:
  schedule:
    - cron: '0 4 */55 * *'  # ูู 55 ููู ุงูุณุงุนุฉ 4:00 ุตุจุงุญูุง
  workflow_dispatch:

jobs:
  refresh-token:
    runs-on: ubuntu-latest

    steps:
    - name: ๐งพ ุงุณุชูุณุงุฎ ุงููุณุชูุฏุน
      uses: actions/checkout@v3

    - name: ๐ ุฅุนุฏุงุฏ Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'

    - name: ๐ฆ ุชุซุจูุช ุงููุชุทูุจุงุช
      run: pip install requests

    - name: ๐ ุชุญุฏูุซ ุงูุชููู
      id: refresh
      env:
        INSTAGRAM_REFRESH_TOKEN: ${{ secrets.INSTAGRAM_REFRESH_TOKEN }}
        META_APP_ID: ${{ secrets.META_APP_ID }}
        META_APP_SECRET: ${{ secrets.META_APP_SECRET }}
      run: |
        new_token=$(python refresh_token.py | tail -n 1)
        echo "token=$new_token" >> $GITHUB_OUTPUT

    - name: โ ุงุณุชุฎุฏุงู ุงูุชููู ุงูุฌุฏูุฏ ูู ุจุงูู ุงูุณูุฑุจุชุงุช
      env:
        INSTAGRAM_ACCESS_TOKEN: ${{ steps.refresh.outputs.token }}
      run: |
        echo "๐ ุณูุชู ุชูุฑูุฑ ุงูุชููู ุฅูู ุณูุฑุจุชุงุช ุงููุดุฑ ุงูุชุงููุฉ ุชููุงุฆููุง."
